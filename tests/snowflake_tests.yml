version: 2

models:
  - name: stg_customers
    description: "Cleaned customer data from raw source"
    columns:
      - name: customer_id
        description: "Primary key for customer"
        tests:
          - unique
          - not_null
      - name: customer_name
        description: "Customer's full name"
      - name: customer_email
        description: "Customer's email address"
      - name: customer_country
        description: "Customer's country of residence"

  - name: stg_orders
    description: "Cleaned order data from raw source"
    columns:
      - name: order_id
        description: "Primary key for order"
        tests:
          - unique
          - not_null
      - name: customer_id
        description: "Foreign key to customer"
        tests:
          - relationships:
              to: ref('stg_customers')
              field: customer_id
      - name: order_date
        description: "Date when the order was placed"
      - name: total_amount
        description: "Total amount of the order"
      - name: order_status
        description: "Status of the order (e.g., completed, pending, canceled)"
        tests:
          - accepted_values:
              values: ['completed', 'pending', 'canceled']

      - name: stg_products
    description: "Cleaned product data from raw source"
    columns:
      - name: product_id
        description: "Primary key for product"
        tests:
          - unique
          - not_null
      - name: product_name
        description: "Name of the product"
      - name: product_category
        description: "Category of the product"
      - name: product_price
        description: "Price of the product"

      - name: stg_order_items
    description: "Cleaned order item data from raw source"
    columns:
      - name: order_item_id
        description: "Primary key for order item"
      - name: order_id
        description: "Foreign key to order"
        tests:
          - relationships:
              to: ref('stg_orders')
              field: order_id
      - name: product_id
        description: "Foreign key to product"
      - name: quantity
        description: "Quantity of the product in the order item"
      - name: unit_price
        description: "Price of the product at the time of the order"
      - name: item_total_amount
        description: "Total amount for this order item (quantity * unit_price)"

  - name: fct_customer_orders
    description: "Aggregated order metrics by customer"
    columns:
      - name: customer_id
        tests:
          - relationships:
              to: ref('stg_customers')
              field: customer_id
      - name: total_orders
        description: "Total number of orders placed by customer"
      - name: total_spend
        description: "Total amount spent by customer across all orders"
      - name: most_recent_order_date
        description: "Date of the most recent order placed by customer" 

  - name: fct_customer_segments
    description: "Customer segmentation based on order behavior"
    columns:
      - name: customer_segment
        description: "Segment based on order frequency (VIP, Loyal, Occasional, New)"
      - name: value_segment
        description: "Segment based on total spend (High, Medium, Low, Minimal Value)"

  - name: fct_daily_order_revenue
    description: "Daily revenue metrics"
    columns:
    - name: order_id
      description: "Primary key for order"
      tests:
        - unique
        - not_null
    - name: order_date
      description: "Date when the order was placed"
      tests:
        - not_null
    - name: total_price
      description: "Total price of the order"

  - name: fct_customer_retintion
    description: "Customer retention metrics"
    columns:
    - name: Cohort_month
        description:"Month when the customer first made a purchase"
    - name: activity_month
        description:"Month when the customer made a purchase"
    - name: months_since_first_purchase
        description:"Number of months since the customer first made a purchase"
    - name: customers_count
        description:"Number of customers in the cohort who made a purchase in the activity month"
    - name: Total_orders
        description:"Total number of orders placed by the cohort in the activity month"
    - name: total_revenue
        description:"Total revenue generated by the cohort in the activity month"
